<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ symbol }} - æ·±åº¦åˆ†ææˆ°æƒ…å®¤</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #0b1622;
            color: #ecf0f1;
            min-height: 100vh;
        }
        .container {
            padding-top: 40px;
        }
        .card {
            background-color: #15202b;
            border: 1px solid #2c3e50;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .title, .subtitle {
            color: #ecf0f1;
        }
        .back-btn {
            margin-bottom: 20px;
        }
        /* è®“åœ–è¡¨å®¹å™¨æœ‰é«˜åº¦ */
        #monte_carlo_chart {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="button is-link is-outlined back-btn">
            â¬…ï¸ è¿”å›ç¸½è¦½
        </a>

        <div class="columns is-vcentered">
            <div class="column">
                <h1 class="title is-2">ğŸš€ {{ symbol }} æ·±åº¦åˆ†æ</h1>
                <p class="subtitle is-5">AI é‹ç®—èˆ‡è’™åœ°å¡ç¾…æ¨¡æ“¬é æ¸¬</p>
            </div>
        </div>

        <div class="card">
            <div class="card-content">
                <div id="loading" class="has-text-centered p-5">
                    <button class="button is-loading is-large is-ghost" style="color: #3e8ed0;">è¼‰å…¥ä¸­</button>
                    <p class="has-text-grey">æ­£åœ¨é€²è¡Œ 100 æ¬¡å¹³è¡Œå®‡å®™æ¨¡æ“¬...</p>
                </div>
                <div id="monte_carlo_chart"></div>
            </div>
        </div>
    </div>

    <script>
        const symbol = "{{ symbol }}";
        
        // æŠ“å–å¾Œç«¯ API è³‡æ–™
        fetch(`/api/details/${symbol}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';

                if (data.error) {
                    document.getElementById('monte_carlo_chart').innerHTML = `<p class="has-text-danger has-text-centered">âš ï¸ è³‡æ–™ä¸è¶³ï¼Œç„¡æ³•é€²è¡Œåˆ†æ</p>`;
                    return;
                }

                const simData = data.simulation;
                const traces = [];

                // 1. ç¹ªè£½ 100 æ¢æ¨¡æ“¬è·¯å¾‘ (è—è‰²ç´°ç·š)
                // æˆ‘å€‘åªå–å‰ 50 æ¢ç•«å‡ºä¾†ï¼Œé¿å…ç€è¦½å™¨å¤ªå¡ï¼Œæ•ˆæœä¸€æ¨£å¥½
                const pathsToShow = simData.paths.slice(0, 50); 
                
                pathsToShow.forEach((path, index) => {
                    traces.push({
                        x: Array.from({length: path.length}, (_, i) => i),
                        y: path,
                        mode: 'lines',
                        type: 'scatter',
                        line: {
                            color: 'rgba(52, 152, 219, 0.15)', // åŠé€æ˜è—è‰²
                            width: 1
                        },
                        hoverinfo: 'none', // éš±è—æ»‘é¼ æç¤ºï¼Œé¿å…å¹²æ“¾
                        name: `è·¯å¾‘ ${index}` // é›–ç„¶æœ‰åå­—ï¼Œä½†æˆ‘å€‘ä¸‹é¢æœƒéš±è—
                    });
                });

                // 2. ç¹ªè£½å¹³å‡è·¯å¾‘ (é»ƒè‰²ç²—ç·š)
                traces.push({
                    x: Array.from({length: simData.mean_path.length}, (_, i) => i),
                    y: simData.mean_path,
                    mode: 'lines',
                    type: 'scatter',
                    line: {
                        color: '#f1c40f', // é®®è±”é»ƒè‰²
                        width: 4
                    },
                    name: 'å¹³å‡è¶¨å‹¢'
                });

                // 3. åœ–è¡¨è¨­å®š (Layout)
                const layout = {
                    title: {
                        text: 'ğŸ”® æœªä¾† 7 å¤©åƒ¹æ ¼é æ¸¬ï¼šè’™åœ°å¡ç¾…æ¨¡æ“¬',
                        font: { color: '#3e8ed0', size: 24 }
                    },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    
                    // ğŸ‘‡ğŸ‘‡ğŸ‘‡ é—œéµä¿®æ”¹ï¼šéš±è—å³å´åœ–ä¾‹ ğŸ‘‡ğŸ‘‡ğŸ‘‡
                    showlegend: false,
                    // ğŸ‘†ğŸ‘†ğŸ‘† é—œéµä¿®æ”¹ï¼šéš±è—å³å´åœ–ä¾‹ ğŸ‘†ğŸ‘†ğŸ‘†

                    xaxis: {
                        title: 'æœªä¾†å¤©æ•¸ (Future Days)',
                        gridcolor: '#2c3e50',
                        zerolinecolor: '#2c3e50',
                        tickfont: { color: '#bdc3c7' },
                        titlefont: { color: '#ecf0f1' }
                    },
                    yaxis: {
                        title: 'é æ¸¬åƒ¹æ ¼ (Price)',
                        gridcolor: '#2c3e50',
                        zerolinecolor: '#2c3e50',
                        tickfont: { color: '#bdc3c7' },
                        titlefont: { color: '#ecf0f1' }
                    },
                    margin: { t: 60, l: 60, r: 30, b: 60 }
                };

                // 4. é–‹å§‹ç¹ªåœ–
                Plotly.newPlot('monte_carlo_chart', traces, layout, {responsive: true});
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('monte_carlo_chart').innerHTML = `<p class="has-text-danger">âŒ è¼‰å…¥å¤±æ•—</p>`;
            });
    </script>
</body>
</html>
